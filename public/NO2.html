<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<head>
    <title>Egg Sitting</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/aqeeggs.css" rel="stylesheet" media="screen">
    <link href="css/style.css" rel="stylesheet" media="screen">
    <style>

    svg {
      padding: 10px 0 0 10px;
    }

    .arc {
      stroke: #fff;
    }

    .svg:not(:hover) .nodetext{
      display: none;
    }

    </style>

    <script src="js/d3.v3.min.js"></script>
</head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="index.html">Egg Sitting</a></li>
              <li><a href="index.html#map">All Eggs</a></li>
              <li><a href="CO.html">Carbon Monoxide (C0)</a></li>
              <li><a href="NO2.html">Nitrous Dioxide (NO2)</a></li>
              <li><a href="VOC.html">Volatile Organic Compounds (VOC)</a></li>
              <li><a href="index.html#team">Add An Egg</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="text-column">
    <p class="title-text">Carbon Monoxide (CO)</p>
    <p> PARAGRAPH </p>
</div>

<script>

var radius = 74,
padding = 10;

var parseDate = d3.time.format.utc("%Y-%m-%dT%H:%M:%SZ").parse;

var x = d3.time.scale()
    .range([0, 150]);

var y = d3.scale.linear()
    .range([200, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var line = d3.svg.line()
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.egg10); });

var color = d3.scale.ordinal()
.range(["#ffa500", "#ff005a", "#00ffa5", "#005aff" ]);

var eggs = [];

function processAndRender (data) {
  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "egg"; }));

data.data.map(function(d) {   
  var id = d.uid;
  var name = d.name;
  var values = d.values;
  var NO2values = d.values.map(function(f){ return f.no2;});
  var dates = d.values.map(function(f){ return f.ts;});

  eggs.push({ egg: id, name: name, allData: values, NO2values: NO2values, avg: d3.mean(NO2values), dates: dates  });
  
  });
console.log(eggs);

  x.domain(d3.extent(data, function(d) { return d.dates; }));
  y.domain(d3.extent(data, function(d) { return d.NO2values; }));



//eggs

var svg = d3.select('body').selectAll('svg')
.data(eggs).enter().append('svg')
.attr('width', 150)
.attr('height', 200)
.attr('class', 'pie');

svg.append('rect')
.attr('width', 150)
.attr('height', 200)
.attr('fill', 'white')
.attr('stroke', 'black')
.attr('stroke-width', 0.5);

svg.append('ellipse')
.attr('cx', 75)
.attr('cy', 100)
.attr('rx', function(d){return d.avg/Math.sqrt(d.avg)*2;})
.attr('ry', function(d){return d.avg/(Math.sqrt(d.avg)*4/5)*2;})
.style('fill', "#ffa500");

svg.append("text")
.attr("x", 30)
.attr("y", 10)
.attr("dy", ".35em")
.style("text-anchor", "middle")
.text(function(d) { return "egg: " + d.name; });

//Line chart

var group = d3.select('svg').selectAll('g')
  .attr('width', 150)
  .attr('height',50);

group.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + 50 + ")")
      .call(xAxis);

group.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Parts Per Billion (ppb)");

group.append("path")
      .datum(eggs)
      .attr("class", "line")
      .attr("d", line);
  }

d3.json("query/col/no2", function(data) {
    console.log("load all CO csv");
    processAndRender(data);

});

</script>
<script src="http://code.jquery.com/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
</body>
</html>
