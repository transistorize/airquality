<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<head>
    <title>Egg Sitting</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/aqeeggs.css" rel="stylesheet" media="screen">
    <link href="css/style.css" rel="stylesheet" media="screen">
    <style>

    svg {
      padding: 10px 0 0 10px;
    }

    .arc {
      stroke: #fff;
    }

    ellipse:hover {
      stroke: #000;
      stroke-width:1;
    }

    @import url(http://fast.fonts.net/jsapi/e6087e24-2280-44b0-a660-e3e0ff2fdb19.js);

    </style>

    <script src="js/d3.v3.min.js"></script>
</head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="index.html">Egg Sitting</a></li>
              <li><a href="index.html#map">All Eggs</a></li>
              <li><a href="CO.html">Carbon Monoxide (C0)</a></li>
              <li><a href="NO2.html">Nitrogen Dioxide (NO2)</a></li>
              <li><a href="VOC.html">Volatile Organic Compounds (VOC)</a></li>
              <li><a href="form.html">Add An Egg</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="text-column">
    <p class="title-text">Volatile Organic Compounds (VOC)</p>
        <br>
     <h3> What is a Volatile Organic Compound? </h3>
    <p>Volatile organic compounds (VOCs) are organic chemicals that have a high vapor pressure at ordinary, room-temperature conditions. Their high vapor pressure results from a low boiling point, which causes large numbers of molecules to evaporate or sublimate from the liquid or solid form of the compound and enter the surrounding air. An example is formaldehyde, with a boiling point of –19 °C (–2 °F), slowly exiting paint and getting into the air.<br>
<br>
VOCs are numerous, varied, and ubiquitous. They include both human-made and naturally occurring chemical compounds. Most scents or odours are of VOCs. Some VOCs are dangerous to human health or cause harm to the environment. Anthropogenic VOCs are regulated by law, especially indoors, where concentrations are the highest. Harmful VOCs are typically not acutely toxic, but instead have compounding long-term health effects. Because the concentrations are usually low and the symptoms slow to develop, research into VOCs and their effects is difficult.
  <br><em>Source: <a href="http://en.wikipedia.org/wiki/Volatile_organic_compound">Wikipedia</a></em>
</div>

<script>

var radius = 74,
padding = 10;

var parseDate = d3.time.format.utc("%Y-%m-%dT%H:%M:%SZ").parse;

var x = d3.time.scale()
    .range([0, 150]);

var y = d3.scale.linear()
    .range([200, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var line = d3.svg.line()
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.egg10); });

var eggs = [];

function processAndRender (data) {
  
data.data.map(function(d) {   
  var id = d.uid;
  var name = d.name;
  var values = d.values;
  var VOCvalues = d.values.map(function(f){ return f.voc;});
  var temp = d.values.map(function(f){ return f.temp_degc;});
  var humidity = d.values.map(function(f){ return f.humidity;});
  var dates = d.values.map(function(f){ return f.ts;});

  eggs.push({ egg: id, name: name, allData: values, VOCvalues: VOCvalues, avgVOC: d3.mean(VOCvalues), dates: dates, avgTempF: (d3.mean(temp)*9/5+32), avgTempC: d3.mean(temp), avgHumidity: d3.mean(humidity)  });
  
  });
console.log(eggs);

  x.domain(d3.extent(data, function(d) { return d.dates; }));
  y.domain(d3.extent(data, function(d) { return d.VOCvalues; }));



//eggs

var svg = d3.select('body').selectAll('svg')
.data(eggs).enter().append('svg')
.attr('width', 150)
.attr('height', 200)
.attr('class', 'pie');

svg.append('rect')
.attr('width', 150)
.attr('height', 200)
.attr('fill', 'white')
.attr('stroke', 'black')
.attr('stroke-width', 0.5);

svg.append('ellipse')
.attr('cx', 75)
.attr('cy', 100)
.attr('rx', function(d){return d.avgVOC/Math.sqrt(d.avgVOC)*2;})
.attr('ry', function(d){return d.avgVOC/(Math.sqrt(d.avgVOC)*4/5)*2;})
.style('fill', "#ff005a")
.on("click", function (d){ console.log(d.egg); var url = "/p/" + d.egg; window.open(url, target="_self"); });
// orange: #ffa500, pink: #ff005a, tealgreen: #00ffa5, bright blue: #005aff, bright light blue: #00daff


svg.append("text")
.attr("x", 30)
.attr("y", 10)
.attr("dy", ".35em")
.style("text-anchor", "middle")
.text(function(d) { return "egg: " + d.name; });

//Line chart

var group = d3.select('svg').selectAll('g')
  .attr('width', 150)
  .attr('height',50);

group.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + 50 + ")")
      .call(xAxis);

group.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Parts Per Billion (ppb)");

group.append("path")
      .datum(eggs)
      .attr("class", "line")
      .attr("d", line);
  }

d3.json("query/col/voc,temp_degc,humidity", function(data) {
    console.log("load all VOC data");
    processAndRender(data);

});

</script>
<script src="http://code.jquery.com/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
</body>
</html>
