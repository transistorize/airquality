<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<head>
    <title>Egg Sitting</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/aqeeggs.css" rel="stylesheet" media="screen">
    <link href="css/style.css" rel="stylesheet" media="screen">
    <style>

    svg {
      padding: 10px 0 0 10px;
    }

    .arc {
      stroke: #fff;
    }

    .svg:not(:hover) .nodetext{
      display: none;
    }

    @import url(http://fast.fonts.net/jsapi/e6087e24-2280-44b0-a660-e3e0ff2fdb19.js);

    </style>

    <script src="js/d3.v3.min.js"></script>
</head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="index.html">Egg Sitting</a></li>
              <li><a href="index.html#map">All Eggs</a></li>
              <li><a href="CO.html">Carbon Monoxide (C0)</a></li>
              <li><a href="NO2.html">Nitrogen Dioxide (NO2)</a></li>
              <li><a href="VOC.html">Volatile Organic Compounds (VOC)</a></li>
              <li><a href="form.html">Add An Egg</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="text-column">
    <p class="title-text">Carbon Monoxide (CO)</p>
    <br>
    <h3> What is Carbon Monoxide? </h3>
    <p>Carbon monoxide (CO) is a colorless, odorless, and tasteless gas that is slightly less dense than air. It is toxic to humans and animals when encountered in higher concentrations, although it is also produced in normal animal metabolism in low quantities, and is thought to have some normal biological functions. In the atmosphere it is spatially variable, short lived, having a role in the formation of ground-level ozone. Carbon monoxide consists of one carbon atom and one oxygen atom, connected by a triple bond that consists of two covalent bonds as well as one dative covalent bond.<br>
<br>
	Carbon monoxide is produced from the partial oxidation of carbon-containing compounds; it forms when there is not enough oxygen to produce carbon dioxide (CO2), such as when operating a stove or an internal combustion engine in an enclosed space. In the presence of oxygen, including atmospheric concentrations, carbon monoxide burns with a blue flame, producing carbon dioxide.[1] Coal gas, which was widely used before the 1960s for domestic lighting, cooking, and heating, had carbon monoxide as a significant fuel constituent. Some processes in modern technology, such as iron smelting, still produce carbon monoxide as a byproduct. 
	<br><em>Source: <a href="http://en.wikipedia.org/wiki/Carbon_monoxide">Wikipedia</a></em>
</p>
</div>

<script>

var radius = 74,
padding = 10
height = 250
width = 200;

var parseDate = d3.time.format.utc("%Y-%m-%dT%H:%M:%SZ").parse;

var x = d3.time.scale()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height/4, height]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var line = d3.svg.line()
    .x(function(d) { return x(d.dates); })
    .y(function(d) { return y(d.COvalues); });

var color = d3.scale.ordinal()
.range(["#ffa500", "#ff005a", "#00ffa5", "#005aff" ]);

var eggs = [];

function processAndRender (data) {
  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "egg"; }));

data.data.map(function(d) {   
  var id = d.uid;
  var values = d.values;
  var name = d.name;
  var COvalues = d.values.map(function(f){ return f.co;});
  var temp = d.values.map(function(f){ return f.temp_degc;});
  var humidity = d.values.map(function(f){ return f.humidity;});
  var dates = d.values.map(function(f){ return f.ts;});

  eggs.push({ egg: id, name: name, allData: values, COvalues: COvalues, avgCO: d3.mean(COvalues), dates: dates, avgTempF: (d3.mean(temp)*9/5+32), avgTempC: d3.mean(temp), avgHumidity: d3.mean(humidity)  });
  
  });
console.log(eggs);

  x.domain(d3.extent(data, function(d) { return d.dates; }));
  y.domain(d3.extent(data, function(d) { return d.COvalues; }));



//eggs

var svg = d3.select('body').selectAll('svg')
.data(eggs).enter().append('svg')
.attr('width', width)
.attr('height', height)
.attr('class', 'pie');

svg.append('rect')
.attr('width', width)
.attr('height', height)
.attr('fill', 'white')
.attr('stroke', 'black')
.attr('stroke-width', 0.5);

svg.append('ellipse')
.attr('cx', 75)
.attr('cy', 100)
.attr('rx', function(d){return d.avgCO/Math.sqrt(d.avgCO)*2;})
.attr('ry', function(d){return d.avgCO/(Math.sqrt(d.avgCO)*4/5)*2;})
.style('fill', "#ffa500");

svg.append("text")
.attr("x", 50)
.attr("y", 10)
.attr("dy", ".35em")
.style("text-anchor", "middle")
.text(function(d) { return "egg: " + d.name; });

//Line chart

var group = svg.append("svg:g")
	.attr('width', 150)
  	.attr('height',50);

group.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + 50 + ")")
      .call(xAxis);

group.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Parts Per Billion (ppb)");

group.append("path")
      .datum(eggs)
      .attr("class", "line")
      .attr("d", line);
  }

d3.json("query/col/co,temp_degc,humidity", function(data) {
    console.log("load all CO data");
    processAndRender(data);

});

</script>
<script src="http://code.jquery.com/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
</body>
</html>
