<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<head>
    <title>Egg Sitting</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/aqeeggs.css" rel="stylesheet" media="screen">
    <link href="css/style.css" rel="stylesheet" media="screen">
    <style>

    svg {
      padding: 10px 0 0 10px;
    }

    .arc {
      stroke: #fff;
    }

    .svg:not(:hover) .nodetext{
      display: none;
    }

    @import url(http://fast.fonts.net/jsapi/e6087e24-2280-44b0-a660-e3e0ff2fdb19.js);

    </style>

    <script src="js/d3.v3.min.js"></script>
</head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="index.html">Egg Sitting</a></li>
              <li><a href="index.html#map">All Eggs</a></li>
              <li><a href="CO.html">Carbon Monoxide (C0)</a></li>
              <li><a href="NO2.html">Nitrogen Dioxide (NO2)</a></li>
              <li><a href="VOC.html">Volatile Organic Compounds (VOC)</a></li>
              <li><a href="form.html">Add An Egg</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="text-column">
    <p class="title-text">Nitrogen Dioxide (NO2)</p>
    <br>
    <h3> What is Nitrogen Dioxide? </h3>
    <p>Nitrogen Dioxide (NO2) is one of several nitrogen oxides. NO2 is an intermediate in the industrial synthesis of nitric acid, millions of tons of which are produced each year. This reddish-brown toxic gas has a characteristic sharp, biting odor and is a prominent air pollutant. Nitrogen dioxide is toxic by inhalation. However, as the compound is acrid and easily detectable by smell at low concentrations, inhalation exposure can generally be avoided.<br>
<br>
One potential source of exposure is fuming nitric acid, which spontaneously produces NO2 above 0 Â°C. Symptoms of poisoning (lung edema) tend to appear several hours after inhalation of a low but potentially fatal dose. Also, low concentrations (4 ppm) will anesthetize the nose, thus creating a potential for overexposure. The most prominent sources of NO2 are internal combustion engines,[9] thermal power stations and, to a lesser extent, pulp mills. Butane gas heaters and stoves are also sources. The excess air required for complete combustion of fuels in these processes introduces nitrogen into the combustion reactions at high temperatures and produces nitrogen oxides (NOx).
  <br><em>Source: <a href="http://en.wikipedia.org/wiki/Nitrogen_dioxide">Wikipedia</a></em>
</p>
</div>

<script>

var radius = 74,
padding = 10;

var parseDate = d3.time.format.utc("%Y-%m-%dT%H:%M:%SZ").parse;

var x = d3.time.scale()
    .range([0, 150]);

var y = d3.scale.linear()
    .range([200, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var line = d3.svg.line()
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.egg10); });

var eggs = [];

function processAndRender (data) {

data.data.forEach(function(d) {   
  var id = d.uid;
  var name = d.name;
  var values = d.values;
  var NO2values = d.values.map(function(f){ return f.no2;});
  var temp = d.values.map(function(f){ return f.temp_degc;});
  var humidity = d.values.map(function(f){ return f.humidity;});
  var dates = d.values.map(function(f){ return f.ts;});

  eggs.push({ egg: id, name: name, allData: values, NO2values: NO2values, avgNO2: d3.mean(NO2values), dates: dates, avgTempF: (d3.mean(temp)*9/5+32), avgTempC: d3.mean(temp), avgHumidity: d3.mean(humidity)  });
  
  });
console.log(eggs);

  x.domain(d3.extent(data, function(d) { return d.dates; }));
  y.domain(d3.extent(data, function(d) { return d.NO2values; }));



//eggs

var svg = d3.select('body').selectAll('svg')
.data(eggs).enter().append('svg')
.attr('width', 150)
.attr('height', 200)
.attr('class', 'pie');

svg.append('rect')
.attr('width', 150)
.attr('height', 200)
.attr('fill', 'white')
.attr('stroke', 'black')
.attr('stroke-width', 0.5);

svg.append('ellipse')
.attr('cx', 75)
.attr('cy', 100)
.attr('rx', function(d){return d.avgNO2/Math.sqrt(d.avgNO2)*2;})
.attr('ry', function(d){return d.avgNO2/(Math.sqrt(d.avgNO2)*4/5)*2;})
.style('fill', "#00ffa5")
.on("click", function (d){ console.log(d.egg); var url = "/p/" + d.egg; window.open(url); });
// orange: #ffa500, pink: #ff005a, tealgreen: #00ffa5, bright blue: #005aff, bright light blue: #00daff

svg.append("text")
.attr("x", 30)
.attr("y", 10)
.attr("dy", ".35em")
.style("text-anchor", "middle")
.text(function(d) { return "egg: " + d.name; });

//Line chart

var group = d3.select('svg').selectAll('g')
  .attr('width', 150)
  .attr('height',50);

group.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + 50 + ")")
      .call(xAxis);

group.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Parts Per Billion (ppb)");

group.append("path")
      .datum(eggs)
      .attr("class", "line")
      .attr("d", line);
  }

d3.json("query/col/no2,temp_degc,humidity", function(data) {
    console.log("load all NO2 data");
    processAndRender(data);

});

</script>
<script src="http://code.jquery.com/jquery.js"></script>
<script src="js/bootstrap.min.js"></script>
</body>
</html>
