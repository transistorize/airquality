<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Egg Sitting: Add an Egg</title>
    <meta charset="utf-8">
    <meta name="description" content="kinisi data platform">

    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/aqeeggs.css" rel="stylesheet" media="screen">
    <link href="css/style.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://underscorejs.org/underscore-min.js" charset="uft-8"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
    <style type="text/css"> @import url(http://fast.fonts.net/jsapi/e6087e24-2280-44b0-a660-e3e0ff2fdb19.js); </style>
    <script type="text/javascript">
    
        // todo make this pick-list pageable

        function renderResponse(err, response) {
            var options = { valueNames: [ 'name', 'created', 'description' ]}, 
                format = d3.time.format("created @ %Y-%m-%d %I:%m %p");

            // remove stand-ins
            d3.selectAll('.removeable').remove();
            
            if (_.has(response, 'platforms') && _.isArray(response.platforms)) {
                items = d3.select('#platforms > ul').selectAll('li')
                    .data(response.platforms).enter()
                    .append('li')
                    .attr('class', 'pickable')
                    .on('click', selectPlatform);

                items.append('span')
                    .attr('class', 'name')
                    .attr('data-uid', function(p) { return p.uid; })
                    .text(function (platform) { return platform.name; });
                items.append('br');
                items.append('small')
                    .attr('class', 'created')
                    .text(function (platform) { return format(new Date(platform.created)); });
                items.append('br');
                items.append('small')
                    .attr('class', 'description')
                    .text(function (platform) { return platform.description; });
                platformList = new List('platforms', options);
            }
        }

        function showPlatforms() {
            d3.select('span#platform_chosen').text('Choose from the list of eggs below');
            d3.select('#platforms').style('display', 'block');
            d3.json('/eggs', renderResponse);                   
        }

        function selectPlatform(platform, index) {
            d3.selectAll('li.chosen').classed('chosen', false);
            d3.select(this).classed('chosen', true);
            d3.select('input#platform_uid').property('value', platform.uid);
            d3.select('span#platform_chosen').text('called ' + platform.name);
            updateSubmitBtnState();
        }

        function clearSelections() {
            d3.selectAll('li.chosen').classed('chosen', false);
            d3.select('input#platform_uid').property('value', null);
            d3.select('span#platform_chosen').text(null); 
            updateSubmitBtnState();
        }

        function fileChosen(input) {
            updateSubmitBtnState(input.value);
        }

        function updateSubmitBtnState(uploadFileName) {
            var datafileInput = uploadFileName || d3.select('input#datafile').property('value');
            var uid = d3.select('input#platform_uid').property('value');
            var isANewPlatform = d3.select('input#new').property('checked');

            if ((datafileInput !== undefined && datafileInput !== '' ) && (isANewPlatform || ( uid !== undefined && uid !== ''))) {
                d3.select('input.submit').attr('disabled', null);
            } else {
                d3.select('input.submit').attr('disabled', 'true');
            }
        }

     
    </script>
    <style>
        @import url(http://fast.fonts.net/jsapi/e6087e24-2280-44b0-a660-e3e0ff2fdb19.js);
        #platforms {
            display:none;
            float:left;
        }
        li.pickable {
            width: 300px;
            margin: 10px;
        }
        li.pickable:hover {
            background-color: lightgray;
        
        }
        li.chosen {
            background-color: lightblue;
        }
        input.search {
            margin: 5px;
        }
        form {
            margin-top: 20px;
        }
        #new, #current {
            padding: 5px;
            margin: 10px;
        }
        #platform_chosen {
            margin-left: 10px;
            font-weight: bold;
        }

    </style>



  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="index.html">Egg Sitting</a></li>
              <li><a href="index.html#map">All Eggs</a></li>
              <li><a href="CO.html">Carbon Monoxide (C0)</a></li>
              <li><a href="NO2.html">Nitrogen Dioxide (NO2)</a></li>
              <li><a href="VOC.html">Volatile Organic Compounds (VOC)</a></li>
              <li><a href="form.html">Add An Egg</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <br>
    <div class='content-wrapper'>
        <div>
            <form method="POST" enctype="multipart/form-data" action="/upload/csv" accept="text"> I want to add data to: 
                <input type="radio" name="platform_type" id="new" value="new" checked="checked" onclick="clearSelections();"> a new egg </input>
                <input type="radio" name="platform_type" id="current" value="established" onclick="showPlatforms();"> a previous egg </input>
                <span id="platform_chosen"></span>
                <input type="hidden"  name="platform_uid" id="platform_uid" />
                
                <br><br>

                CSV data file to upload: <input type="file" id="datafile" name="datafile" onchange="fileChosen(this);" /><br><br>
                Description (optional): <input type="text" name="description" /><br><br>
                <input class='submit' type="submit" value="Submit this CSV file" disabled="true" />
            </form>
        </div>
        <div id="platforms">
            Search listed eggs: <input class="search" />
            <br>
            <ul class="list">
                <li class="removeable"> 
                    <span class="name">Getting all eggs - hold on tight!</span>
                </li>
            </ul>
        </div>
    </div>
  </body>
</html>

